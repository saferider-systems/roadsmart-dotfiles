-- ============================================================================
-- PARTITION _transmissions FROM 2020 TO 2027
-- ============================================================================
-- Step 1: Remove AUTO_INCREMENT from id column temporarily
ALTER TABLE _transmissions MODIFY COLUMN id INT NOT NULL;

-- Step 2: Drop the existing primary key
ALTER TABLE _transmissions DROP PRIMARY KEY;

-- Step 3: Add new composite primary key that includes the partitioning column
ALTER TABLE _transmissions ADD PRIMARY KEY (id, createdAt);

-- Step 4: Restore AUTO_INCREMENT on id column
ALTER TABLE _transmissions MODIFY COLUMN id INT NOT NULL AUTO_INCREMENT;

-- Step 5: Apply partitioning
ALTER TABLE _transmissions 
PARTITION BY RANGE (YEAR(createdAt) * 100 + MONTH(createdAt)) (
    -- 2020 partitions (likely empty, but safe to have)
    PARTITION p_2020_01 VALUES LESS THAN (202002),
    PARTITION p_2020_02 VALUES LESS THAN (202003),
    PARTITION p_2020_03 VALUES LESS THAN (202004),
    PARTITION p_2020_04 VALUES LESS THAN (202005),
    PARTITION p_2020_05 VALUES LESS THAN (202006),
    PARTITION p_2020_06 VALUES LESS THAN (202007),
    PARTITION p_2020_07 VALUES LESS THAN (202008),
    PARTITION p_2020_08 VALUES LESS THAN (202009),
    PARTITION p_2020_09 VALUES LESS THAN (202010),
    PARTITION p_2020_10 VALUES LESS THAN (202011),
    PARTITION p_2020_11 VALUES LESS THAN (202012),
    PARTITION p_2020_12 VALUES LESS THAN (202101),
    
    -- 2021 partitions
    PARTITION p_2021_01 VALUES LESS THAN (202102),
    PARTITION p_2021_02 VALUES LESS THAN (202103),
    PARTITION p_2021_03 VALUES LESS THAN (202104),
    PARTITION p_2021_04 VALUES LESS THAN (202105),
    PARTITION p_2021_05 VALUES LESS THAN (202106),
    PARTITION p_2021_06 VALUES LESS THAN (202107),
    PARTITION p_2021_07 VALUES LESS THAN (202108),
    PARTITION p_2021_08 VALUES LESS THAN (202109),
    PARTITION p_2021_09 VALUES LESS THAN (202110),
    PARTITION p_2021_10 VALUES LESS THAN (202111),
    PARTITION p_2021_11 VALUES LESS THAN (202112),
    PARTITION p_2021_12 VALUES LESS THAN (202201),
    
    -- 2022 partitions
    PARTITION p_2022_01 VALUES LESS THAN (202202),
    PARTITION p_2022_02 VALUES LESS THAN (202203),
    PARTITION p_2022_03 VALUES LESS THAN (202204),
    PARTITION p_2022_04 VALUES LESS THAN (202205),
    PARTITION p_2022_05 VALUES LESS THAN (202206),
    PARTITION p_2022_06 VALUES LESS THAN (202207),
    PARTITION p_2022_07 VALUES LESS THAN (202208),
    PARTITION p_2022_08 VALUES LESS THAN (202209),
    PARTITION p_2022_09 VALUES LESS THAN (202210),
    PARTITION p_2022_10 VALUES LESS THAN (202211),
    PARTITION p_2022_11 VALUES LESS THAN (202212),
    PARTITION p_2022_12 VALUES LESS THAN (202301),
    
    -- 2023 partitions
    PARTITION p_2023_01 VALUES LESS THAN (202302),
    PARTITION p_2023_02 VALUES LESS THAN (202303),
    PARTITION p_2023_03 VALUES LESS THAN (202304),
    PARTITION p_2023_04 VALUES LESS THAN (202305),
    PARTITION p_2023_05 VALUES LESS THAN (202306),
    PARTITION p_2023_06 VALUES LESS THAN (202307),
    PARTITION p_2023_07 VALUES LESS THAN (202308),
    PARTITION p_2023_08 VALUES LESS THAN (202309),
    PARTITION p_2023_09 VALUES LESS THAN (202310),
    PARTITION p_2023_10 VALUES LESS THAN (202311),
    PARTITION p_2023_11 VALUES LESS THAN (202312),
    PARTITION p_2023_12 VALUES LESS THAN (202401),
    
    -- 2024 partitions
    PARTITION p_2024_01 VALUES LESS THAN (202402),
    PARTITION p_2024_02 VALUES LESS THAN (202403),
    PARTITION p_2024_03 VALUES LESS THAN (202404),
    PARTITION p_2024_04 VALUES LESS THAN (202405),
    PARTITION p_2024_05 VALUES LESS THAN (202406),
    PARTITION p_2024_06 VALUES LESS THAN (202407),
    PARTITION p_2024_07 VALUES LESS THAN (202408),
    PARTITION p_2024_08 VALUES LESS THAN (202409),
    PARTITION p_2024_09 VALUES LESS THAN (202410),
    PARTITION p_2024_10 VALUES LESS THAN (202411),
    PARTITION p_2024_11 VALUES LESS THAN (202412),
    PARTITION p_2024_12 VALUES LESS THAN (202501),
    
    -- 2025 partitions
    PARTITION p_2025_01 VALUES LESS THAN (202502),
    PARTITION p_2025_02 VALUES LESS THAN (202503),
    PARTITION p_2025_03 VALUES LESS THAN (202504),
    PARTITION p_2025_04 VALUES LESS THAN (202505),
    PARTITION p_2025_05 VALUES LESS THAN (202506),
    PARTITION p_2025_06 VALUES LESS THAN (202507),
    PARTITION p_2025_07 VALUES LESS THAN (202508),
    PARTITION p_2025_08 VALUES LESS THAN (202509),
    PARTITION p_2025_09 VALUES LESS THAN (202510),
    PARTITION p_2025_10 VALUES LESS THAN (202511),
    PARTITION p_2025_11 VALUES LESS THAN (202512),
    PARTITION p_2025_12 VALUES LESS THAN (202601),
    
    -- 2026 partitions (current year)
    PARTITION p_2026_01 VALUES LESS THAN (202602),
    PARTITION p_2026_02 VALUES LESS THAN (202603),
    PARTITION p_2026_03 VALUES LESS THAN (202604),
    PARTITION p_2026_04 VALUES LESS THAN (202605),
    PARTITION p_2026_05 VALUES LESS THAN (202606),
    PARTITION p_2026_06 VALUES LESS THAN (202607),
    PARTITION p_2026_07 VALUES LESS THAN (202608),
    PARTITION p_2026_08 VALUES LESS THAN (202609),
    PARTITION p_2026_09 VALUES LESS THAN (202610),
    PARTITION p_2026_10 VALUES LESS THAN (202611),
    PARTITION p_2026_11 VALUES LESS THAN (202612),
    PARTITION p_2026_12 VALUES LESS THAN (202701),
    
    -- 2027 partitions (future)
    PARTITION p_2027_01 VALUES LESS THAN (202702),
    PARTITION p_2027_02 VALUES LESS THAN (202703),
    PARTITION p_2027_03 VALUES LESS THAN (202704),
    PARTITION p_2027_04 VALUES LESS THAN (202705),
    PARTITION p_2027_05 VALUES LESS THAN (202706),
    PARTITION p_2027_06 VALUES LESS THAN (202707),
    PARTITION p_2027_07 VALUES LESS THAN (202708),
    PARTITION p_2027_08 VALUES LESS THAN (202709),
    PARTITION p_2027_09 VALUES LESS THAN (202710),
    PARTITION p_2027_10 VALUES LESS THAN (202711),
    PARTITION p_2027_11 VALUES LESS THAN (202712),
    PARTITION p_2027_12 VALUES LESS THAN (202801),
    
    -- Catch-all for any data beyond 2027
    PARTITION p_future VALUES LESS THAN MAXVALUE
);
